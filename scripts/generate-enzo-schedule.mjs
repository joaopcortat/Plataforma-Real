/**
 * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 *  CRONOGRAMA INDIVIDUALIZADO ‚Äî ENZO MARTINS
 *  Medicina UEPA | 3¬∫ Ano EM | ENEM 2026
 * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 *
 *  Perfil:
 *  - Dificuldade em F√≠sica (geral) e Estequiometria (Qu√≠mica)
 *  - Precisa de base s√≥lida at√© Junho
 *  - Cobertura total at√© Setembro
 *  - Prioridade: Natureza + Matem√°tica
 *  - Sem L√≠nguas
 *  - Reda√ß√£o a cada 2 semanas
 *  - Revis√£o espa√ßada D+1, D+7, D+30
 *
 *  Disponibilidade Semanal:
 *  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
 *  ‚îÇ Dia      ‚îÇ Janela                      ‚îÇ Horas    ‚îÇ
 *  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
 *  ‚îÇ Domingo  ‚îÇ 09:00‚Äì12:00 + 13:30‚Äì16:30   ‚îÇ 6.0h     ‚îÇ
 *  ‚îÇ Segunda  ‚îÇ 20:00‚Äì21:30                 ‚îÇ 1.5h     ‚îÇ
 *  ‚îÇ Ter√ßa    ‚îÇ 20:00‚Äì21:30                 ‚îÇ 1.5h     ‚îÇ
 *  ‚îÇ Quarta   ‚îÇ 19:00‚Äì21:30                 ‚îÇ 2.5h     ‚îÇ
 *  ‚îÇ Quinta   ‚îÇ 15:00‚Äì18:00 + 18:30‚Äì21:30   ‚îÇ 6.0h     ‚îÇ
 *  ‚îÇ Sexta    ‚îÇ 15:00‚Äì18:00 + 18:30‚Äì21:30   ‚îÇ 6.0h     ‚îÇ
 *  ‚îÇ S√°bado   ‚îÇ ‚Äî                           ‚îÇ 0        ‚îÇ
 *  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
 *  Total: 23.5h/semana
 */

import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

const SUPABASE_URL = 'https://tgybzzknpcrwjseotbrc.supabase.co';
const SUPABASE_KEY = 'sb_publishable_qqwQcKm-9DgRs-i8rCU6MA_wxseSbFg';
const ENZO_EMAIL = 'enzomartins0508@gmail.com';

const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CONTE√öDO PROGRAM√ÅTICO ENEM ‚Äî EXPANDIDO PARA ENZO
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// Each topic: [subject, title, type, estimatedMinutes, phase]
// phase: 1 = Funda√ß√£o (Fev‚ÄìAbr), 2 = Constru√ß√£o (Mai‚ÄìJul), 3 = Aprofundamento (Ago‚ÄìSet)

const CURRICULUM = [
    // ‚ïê‚ïê‚ïê MATEM√ÅTICA (sess√µes longas, prioridade alta) ‚ïê‚ïê‚ïê
    // Fase 1 ‚Äî Funda√ß√£o
    { subject: 'Matem√°tica', title: 'Opera√ß√µes Fundamentais e Propriedades Num√©ricas', type: 'class', minutes: 90, phase: 1 },
    { subject: 'Matem√°tica', title: 'Fra√ß√µes, Decimais e Potencia√ß√£o', type: 'class', minutes: 90, phase: 1 },
    { subject: 'Matem√°tica', title: 'Express√µes Num√©ricas e Fatora√ß√£o', type: 'class', minutes: 60, phase: 1 },
    { subject: 'Matem√°tica', title: 'Regra de Tr√™s Simples e Composta', type: 'class', minutes: 90, phase: 1 },
    { subject: 'Matem√°tica', title: 'Raz√£o, Propor√ß√£o e Grandezas', type: 'class', minutes: 90, phase: 1 },
    { subject: 'Matem√°tica', title: 'Porcentagem ‚Äî Conceito e Problemas', type: 'class', minutes: 60, phase: 1 },
    { subject: 'Matem√°tica', title: 'Matem√°tica Financeira B√°sica (Juros Simples/Compostos)', type: 'class', minutes: 90, phase: 1 },
    { subject: 'Matem√°tica', title: 'Estat√≠stica ‚Äî M√©dia, Moda e Mediana', type: 'class', minutes: 60, phase: 1 },
    { subject: 'Matem√°tica', title: 'Leitura e Interpreta√ß√£o de Gr√°ficos e Tabelas', type: 'class', minutes: 60, phase: 1 },
    { subject: 'Matem√°tica', title: 'Equa√ß√µes de 1¬∫ Grau e Sistemas', type: 'class', minutes: 90, phase: 1 },
    { subject: 'Matem√°tica', title: 'Equa√ß√µes de 2¬∫ Grau ‚Äî Bhaskara e Soma/Produto', type: 'class', minutes: 90, phase: 1 },
    // Fase 2 ‚Äî Constru√ß√£o
    { subject: 'Matem√°tica', title: 'Fun√ß√µes ‚Äî Conceito, Dom√≠nio e Imagem', type: 'class', minutes: 90, phase: 2 },
    { subject: 'Matem√°tica', title: 'Fun√ß√£o Afim ‚Äî Gr√°ficos e Problemas', type: 'class', minutes: 90, phase: 2 },
    { subject: 'Matem√°tica', title: 'Fun√ß√£o Quadr√°tica ‚Äî An√°lise de Gr√°ficos e V√©rtice', type: 'class', minutes: 90, phase: 2 },
    { subject: 'Matem√°tica', title: 'Fun√ß√£o Exponencial e Aplica√ß√µes', type: 'class', minutes: 60, phase: 2 },
    { subject: 'Matem√°tica', title: 'Logaritmos ‚Äî Propriedades e Equa√ß√µes', type: 'class', minutes: 90, phase: 2 },
    { subject: 'Matem√°tica', title: 'Geometria Plana ‚Äî √Çngulos e Tri√¢ngulos', type: 'class', minutes: 90, phase: 2 },
    { subject: 'Matem√°tica', title: 'Geometria Plana ‚Äî √Åreas de Figuras Planas', type: 'class', minutes: 90, phase: 2 },
    { subject: 'Matem√°tica', title: 'Geometria Plana ‚Äî Circunfer√™ncia e Pol√≠gonos', type: 'class', minutes: 60, phase: 2 },
    { subject: 'Matem√°tica', title: 'Geometria Espacial ‚Äî Prismas e Cilindros', type: 'class', minutes: 90, phase: 2 },
    { subject: 'Matem√°tica', title: 'Geometria Espacial ‚Äî Pir√¢mide, Cone e Esfera', type: 'class', minutes: 90, phase: 2 },
    // Fase 3 ‚Äî Aprofundamento
    { subject: 'Matem√°tica', title: 'An√°lise Combinat√≥ria ‚Äî Princ√≠pio Fundamental', type: 'class', minutes: 90, phase: 3 },
    { subject: 'Matem√°tica', title: 'Permuta√ß√µes, Arranjos e Combina√ß√µes', type: 'class', minutes: 90, phase: 3 },
    { subject: 'Matem√°tica', title: 'Probabilidade ‚Äî Eventos e C√°lculos', type: 'class', minutes: 90, phase: 3 },
    { subject: 'Matem√°tica', title: 'Trigonometria ‚Äî Raz√µes no Tri√¢ngulo Ret√¢ngulo', type: 'class', minutes: 60, phase: 3 },
    { subject: 'Matem√°tica', title: 'Trigonometria ‚Äî Ciclo Trigonom√©trico', type: 'class', minutes: 60, phase: 3 },
    { subject: 'Matem√°tica', title: 'Progress√£o Aritm√©tica (PA)', type: 'class', minutes: 60, phase: 3 },
    { subject: 'Matem√°tica', title: 'Progress√£o Geom√©trica (PG)', type: 'class', minutes: 60, phase: 3 },
    { subject: 'Matem√°tica', title: 'Matrizes e Determinantes', type: 'class', minutes: 60, phase: 3 },

    // ‚ïê‚ïê‚ïê F√çSICA (PRIORIDADE M√ÅXIMA ‚Äî dificuldade do aluno) ‚ïê‚ïê‚ïê
    // Fase 1 ‚Äî Funda√ß√£o (do zero)
    { subject: 'F√≠sica', title: 'Introdu√ß√£o √† F√≠sica ‚Äî Unidades e Convers√µes', type: 'class', minutes: 60, phase: 1 },
    { subject: 'F√≠sica', title: 'Cinem√°tica ‚Äî Velocidade M√©dia e MRU', type: 'class', minutes: 90, phase: 1 },
    { subject: 'F√≠sica', title: 'Cinem√°tica ‚Äî MRUV e Queda Livre', type: 'class', minutes: 90, phase: 1 },
    { subject: 'F√≠sica', title: 'Cinem√°tica ‚Äî Gr√°ficos de Movimento', type: 'class', minutes: 60, phase: 1 },
    { subject: 'F√≠sica', title: 'Vetores ‚Äî Soma e Decomposi√ß√£o', type: 'class', minutes: 60, phase: 1 },
    { subject: 'F√≠sica', title: 'Din√¢mica ‚Äî 1¬™ Lei de Newton (In√©rcia)', type: 'class', minutes: 60, phase: 1 },
    { subject: 'F√≠sica', title: 'Din√¢mica ‚Äî 2¬™ Lei de Newton (F=ma)', type: 'class', minutes: 90, phase: 1 },
    { subject: 'F√≠sica', title: 'Din√¢mica ‚Äî 3¬™ Lei de Newton e Aplica√ß√µes', type: 'class', minutes: 60, phase: 1 },
    { subject: 'F√≠sica', title: 'For√ßas ‚Äî Peso, Normal, Atrito e Tra√ß√£o', type: 'class', minutes: 90, phase: 1 },
    { subject: 'F√≠sica', title: 'Plano Inclinado e Elevadores', type: 'class', minutes: 60, phase: 1 },
    // Fase 2 ‚Äî Constru√ß√£o
    { subject: 'F√≠sica', title: 'Trabalho e Energia Cin√©tica', type: 'class', minutes: 90, phase: 2 },
    { subject: 'F√≠sica', title: 'Energia Potencial e Conserva√ß√£o de Energia', type: 'class', minutes: 90, phase: 2 },
    { subject: 'F√≠sica', title: 'Pot√™ncia e Rendimento', type: 'class', minutes: 60, phase: 2 },
    { subject: 'F√≠sica', title: 'Impulso e Quantidade de Movimento', type: 'class', minutes: 60, phase: 2 },
    { subject: 'F√≠sica', title: 'Termologia ‚Äî Temperatura, Escalas e Dilata√ß√£o', type: 'class', minutes: 90, phase: 2 },
    { subject: 'F√≠sica', title: 'Calorimetria ‚Äî Calor Sens√≠vel e Latente', type: 'class', minutes: 90, phase: 2 },
    { subject: 'F√≠sica', title: 'Termodin√¢mica ‚Äî 1¬™ e 2¬™ Lei', type: 'class', minutes: 90, phase: 2 },
    { subject: 'F√≠sica', title: 'Hidrost√°tica ‚Äî Press√£o, Empuxo e Princ√≠pio de Pascal', type: 'class', minutes: 90, phase: 2 },
    { subject: 'F√≠sica', title: '√ìptica ‚Äî Reflex√£o e Espelhos', type: 'class', minutes: 60, phase: 2 },
    { subject: 'F√≠sica', title: '√ìptica ‚Äî Refra√ß√£o e Lentes', type: 'class', minutes: 60, phase: 2 },
    // Fase 3 ‚Äî Aprofundamento
    { subject: 'F√≠sica', title: 'Ondulat√≥ria ‚Äî Conceitos e Propriedades', type: 'class', minutes: 90, phase: 3 },
    { subject: 'F√≠sica', title: 'Ac√∫stica ‚Äî Som e Fen√¥menos Sonoros', type: 'class', minutes: 60, phase: 3 },
    { subject: 'F√≠sica', title: 'Eletrost√°tica ‚Äî Carga, Campo e Potencial', type: 'class', minutes: 90, phase: 3 },
    { subject: 'F√≠sica', title: 'Eletrodin√¢mica ‚Äî Corrente, Resist√™ncia e Lei de Ohm', type: 'class', minutes: 90, phase: 3 },
    { subject: 'F√≠sica', title: 'Circuitos El√©tricos ‚Äî S√©rie, Paralelo e Pot√™ncia', type: 'class', minutes: 90, phase: 3 },
    { subject: 'F√≠sica', title: 'Eletromagnetismo ‚Äî Campo Magn√©tico e For√ßa', type: 'class', minutes: 60, phase: 3 },
    { subject: 'F√≠sica', title: 'Indu√ß√£o Eletromagn√©tica e Aplica√ß√µes', type: 'class', minutes: 60, phase: 3 },

    // ‚ïê‚ïê‚ïê QU√çMICA (aten√ß√£o especial em Estequiometria) ‚ïê‚ïê‚ïê
    // Fase 1
    { subject: 'Qu√≠mica', title: 'Propriedades da Mat√©ria e Separa√ß√£o de Misturas', type: 'class', minutes: 60, phase: 1 },
    { subject: 'Qu√≠mica', title: 'Modelos At√¥micos e Estrutura do √Åtomo', type: 'class', minutes: 60, phase: 1 },
    { subject: 'Qu√≠mica', title: 'Tabela Peri√≥dica ‚Äî Propriedades e Organiza√ß√£o', type: 'class', minutes: 60, phase: 1 },
    { subject: 'Qu√≠mica', title: 'Liga√ß√µes Qu√≠micas ‚Äî I√¥nica, Covalente e Met√°lica', type: 'class', minutes: 90, phase: 1 },
    { subject: 'Qu√≠mica', title: 'Polaridade e For√ßas Intermoleculares', type: 'class', minutes: 60, phase: 1 },
    { subject: 'Qu√≠mica', title: 'Fun√ß√µes Inorg√¢nicas ‚Äî √Åcidos e Bases', type: 'class', minutes: 60, phase: 1 },
    { subject: 'Qu√≠mica', title: 'Fun√ß√µes Inorg√¢nicas ‚Äî Sais e √ìxidos', type: 'class', minutes: 60, phase: 1 },
    { subject: 'Qu√≠mica', title: 'Rea√ß√µes Inorg√¢nicas e Balanceamento', type: 'class', minutes: 60, phase: 1 },
    // Fase 2 ‚Äî Estequiometria (foco especial!)
    { subject: 'Qu√≠mica', title: '‚ö†Ô∏è Estequiometria ‚Äî Mol, Massa Molar e N¬∫ de Avogadro', type: 'class', minutes: 90, phase: 2 },
    { subject: 'Qu√≠mica', title: '‚ö†Ô∏è Estequiometria ‚Äî Rela√ß√µes Estequiom√©tricas', type: 'class', minutes: 90, phase: 2 },
    { subject: 'Qu√≠mica', title: '‚ö†Ô∏è Estequiometria ‚Äî Pureza e Rendimento', type: 'class', minutes: 60, phase: 2 },
    { subject: 'Qu√≠mica', title: '‚ö†Ô∏è Estequiometria ‚Äî Exerc√≠cios Intensivos', type: 'exercise', minutes: 90, phase: 2 },
    { subject: 'Qu√≠mica', title: 'Solu√ß√µes ‚Äî Concentra√ß√£o e Dilui√ß√£o', type: 'class', minutes: 90, phase: 2 },
    { subject: 'Qu√≠mica', title: 'Termoqu√≠mica ‚Äî Entalpia e Lei de Hess', type: 'class', minutes: 90, phase: 2 },
    { subject: 'Qu√≠mica', title: 'Cin√©tica Qu√≠mica ‚Äî Velocidade e Fatores', type: 'class', minutes: 60, phase: 2 },
    { subject: 'Qu√≠mica', title: 'Qu√≠mica Org√¢nica ‚Äî Classifica√ß√£o de Cadeias', type: 'class', minutes: 60, phase: 2 },
    { subject: 'Qu√≠mica', title: 'Qu√≠mica Org√¢nica ‚Äî Fun√ß√µes Org√¢nicas I (Hidrocarbonetos, √Ålcoois)', type: 'class', minutes: 90, phase: 2 },
    // Fase 3
    { subject: 'Qu√≠mica', title: 'Qu√≠mica Org√¢nica ‚Äî Fun√ß√µes Org√¢nicas II (√Åcidos, √âsteres, Aminas)', type: 'class', minutes: 90, phase: 3 },
    { subject: 'Qu√≠mica', title: 'Isomeria ‚Äî Plana e Espacial', type: 'class', minutes: 60, phase: 3 },
    { subject: 'Qu√≠mica', title: 'Equil√≠brio Qu√≠mico ‚Äî Constante e Princ√≠pio de Le Chatelier', type: 'class', minutes: 90, phase: 3 },
    { subject: 'Qu√≠mica', title: 'pH e pOH ‚Äî C√°lculos e Aplica√ß√µes', type: 'class', minutes: 60, phase: 3 },
    { subject: 'Qu√≠mica', title: 'Eletroqu√≠mica ‚Äî Pilhas e Eletr√≥lise', type: 'class', minutes: 90, phase: 3 },
    { subject: 'Qu√≠mica', title: 'Rea√ß√µes Org√¢nicas ‚Äî Adi√ß√£o, Substitui√ß√£o, Elimina√ß√£o', type: 'class', minutes: 60, phase: 3 },

    // ‚ïê‚ïê‚ïê BIOLOGIA ‚ïê‚ïê‚ïê
    // Fase 1
    { subject: 'Biologia', title: 'Ecologia ‚Äî Cadeias Alimentares e Teias', type: 'class', minutes: 60, phase: 1 },
    { subject: 'Biologia', title: 'Ecologia ‚Äî Ciclos Biogeoqu√≠micos', type: 'class', minutes: 60, phase: 1 },
    { subject: 'Biologia', title: 'Ecologia ‚Äî Rela√ß√µes Ecol√≥gicas', type: 'class', minutes: 60, phase: 1 },
    { subject: 'Biologia', title: 'Citologia ‚Äî C√©lula Eucarionte e Procarionte', type: 'class', minutes: 60, phase: 1 },
    { subject: 'Biologia', title: 'Citologia ‚Äî Organelas e Membrana Plasm√°tica', type: 'class', minutes: 60, phase: 1 },
    { subject: 'Biologia', title: 'Bioenerg√©tica ‚Äî Fotoss√≠ntese', type: 'class', minutes: 60, phase: 1 },
    { subject: 'Biologia', title: 'Bioenerg√©tica ‚Äî Respira√ß√£o Celular e Fermenta√ß√£o', type: 'class', minutes: 60, phase: 1 },
    // Fase 2
    { subject: 'Biologia', title: 'Divis√£o Celular ‚Äî Mitose e Meiose', type: 'class', minutes: 60, phase: 2 },
    { subject: 'Biologia', title: 'Gen√©tica ‚Äî 1¬™ Lei de Mendel', type: 'class', minutes: 90, phase: 2 },
    { subject: 'Biologia', title: 'Gen√©tica ‚Äî 2¬™ Lei de Mendel e Heran√ßa', type: 'class', minutes: 90, phase: 2 },
    { subject: 'Biologia', title: 'Gen√©tica ‚Äî Grupos Sangu√≠neos e Ligada ao Sexo', type: 'class', minutes: 60, phase: 2 },
    { subject: 'Biologia', title: 'Fisiologia Humana ‚Äî Sistema Digest√≥rio e Respirat√≥rio', type: 'class', minutes: 90, phase: 2 },
    { subject: 'Biologia', title: 'Fisiologia Humana ‚Äî Sistema Circulat√≥rio e Excretor', type: 'class', minutes: 90, phase: 2 },
    { subject: 'Biologia', title: 'Fisiologia Humana ‚Äî Sistema Nervoso e End√≥crino', type: 'class', minutes: 60, phase: 2 },
    // Fase 3
    { subject: 'Biologia', title: 'Evolu√ß√£o ‚Äî Teorias e Evid√™ncias', type: 'class', minutes: 60, phase: 3 },
    { subject: 'Biologia', title: 'Biotecnologia ‚Äî DNA Recombinante e Transg√™nicos', type: 'class', minutes: 60, phase: 3 },
    { subject: 'Biologia', title: 'Bot√¢nica ‚Äî Fisiologia Vegetal', type: 'class', minutes: 60, phase: 3 },
    { subject: 'Biologia', title: 'Zoologia ‚Äî Classifica√ß√£o e Filos Principais', type: 'class', minutes: 60, phase: 3 },
    { subject: 'Biologia', title: 'Impactos Ambientais e Sustentabilidade', type: 'class', minutes: 60, phase: 3 },

    // ‚ïê‚ïê‚ïê HIST√ìRIA ‚ïê‚ïê‚ïê
    // Fase 1
    { subject: 'Hist√≥ria', title: 'Brasil Col√¥nia ‚Äî Capitanias e Economia Colonial', type: 'class', minutes: 90, phase: 1 },
    { subject: 'Hist√≥ria', title: 'Brasil Col√¥nia ‚Äî Escravid√£o e Sociedade', type: 'class', minutes: 60, phase: 1 },
    // Fase 2
    { subject: 'Hist√≥ria', title: 'Brasil Imp√©rio ‚Äî Independ√™ncia e 1¬∫ Reinado', type: 'class', minutes: 90, phase: 2 },
    { subject: 'Hist√≥ria', title: 'Brasil Imp√©rio ‚Äî 2¬∫ Reinado e Aboli√ß√£o', type: 'class', minutes: 60, phase: 2 },
    { subject: 'Hist√≥ria', title: 'Brasil Rep√∫blica ‚Äî Rep√∫blica Velha e Vargas', type: 'class', minutes: 90, phase: 2 },
    { subject: 'Hist√≥ria', title: 'Brasil Rep√∫blica ‚Äî Ditadura Militar', type: 'class', minutes: 90, phase: 2 },
    // Fase 3
    { subject: 'Hist√≥ria', title: 'Idade M√©dia ‚Äî Feudalismo e Igreja', type: 'class', minutes: 60, phase: 3 },
    { subject: 'Hist√≥ria', title: 'Revolu√ß√£o Industrial e Iluminismo', type: 'class', minutes: 60, phase: 3 },
    { subject: 'Hist√≥ria', title: 'Guerras Mundiais e Per√≠odo Entreguerras', type: 'class', minutes: 90, phase: 3 },
    { subject: 'Hist√≥ria', title: 'Guerra Fria e Mundo Contempor√¢neo', type: 'class', minutes: 60, phase: 3 },

    // ‚ïê‚ïê‚ïê GEOGRAFIA ‚ïê‚ïê‚ïê
    // Fase 1
    { subject: 'Geografia', title: 'Geopol√≠tica ‚Äî Globaliza√ß√£o e Blocos Econ√¥micos', type: 'class', minutes: 60, phase: 1 },
    { subject: 'Geografia', title: 'Urbaniza√ß√£o ‚Äî Problemas Urbanos e Faveliza√ß√£o', type: 'class', minutes: 60, phase: 1 },
    // Fase 2
    { subject: 'Geografia', title: 'Geografia Agr√°ria ‚Äî Estrutura Fundi√°ria e Agroneg√≥cio', type: 'class', minutes: 60, phase: 2 },
    { subject: 'Geografia', title: 'Meio Ambiente ‚Äî Biomas Brasileiros', type: 'class', minutes: 60, phase: 2 },
    { subject: 'Geografia', title: 'Climatologia ‚Äî Climas do Brasil e do Mundo', type: 'class', minutes: 60, phase: 2 },
    { subject: 'Geografia', title: 'Geomorfologia ‚Äî Relevo e Solos', type: 'class', minutes: 60, phase: 2 },
    // Fase 3
    { subject: 'Geografia', title: 'Demografia ‚Äî Teorias Populacionais e Pir√¢mides', type: 'class', minutes: 60, phase: 3 },
    { subject: 'Geografia', title: 'Hidrografia ‚Äî Bacias Hidrogr√°ficas e Recursos H√≠dricos', type: 'class', minutes: 60, phase: 3 },
    { subject: 'Geografia', title: 'Geografia Econ√¥mica ‚Äî Industrializa√ß√£o e Energia', type: 'class', minutes: 60, phase: 3 },

    // ‚ïê‚ïê‚ïê FILOSOFIA / SOCIOLOGIA ‚ïê‚ïê‚ïê
    { subject: 'Filosofia/Sociologia', title: 'Filosofia Cl√°ssica ‚Äî S√≥crates, Plat√£o e Arist√≥teles', type: 'class', minutes: 60, phase: 2 },
    { subject: 'Filosofia/Sociologia', title: 'Filosofia Pol√≠tica ‚Äî Contratualismo e Estado', type: 'class', minutes: 60, phase: 2 },
    { subject: 'Filosofia/Sociologia', title: 'Sociologia ‚Äî Durkheim, Weber e Marx', type: 'class', minutes: 60, phase: 3 },
    { subject: 'Filosofia/Sociologia', title: 'Cidadania, Direitos Humanos e Cultura', type: 'class', minutes: 60, phase: 3 },
];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  DISPONIBILIDADE SEMANAL DO ENZO
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  dow: 0=Dom, 1=Seg, 2=Ter, 3=Qua, 4=Qui, 5=Sex, 6=Sab
const AVAILABILITY = {
    0: [ // Domingo
        { start: '09:00', minutes: 180 }, // 09:00‚Äì12:00
        { start: '13:30', minutes: 180 }, // 13:30‚Äì16:30
    ],
    1: [ // Segunda
        { start: '20:00', minutes: 90 },  // 20:00‚Äì21:30
    ],
    2: [ // Ter√ßa
        { start: '20:00', minutes: 90 },  // 20:00‚Äì21:30
    ],
    3: [ // Quarta
        { start: '19:00', minutes: 150 }, // 19:00‚Äì21:30
    ],
    4: [ // Quinta
        { start: '15:00', minutes: 180 }, // 15:00‚Äì18:00
        { start: '18:30', minutes: 180 }, // 18:30‚Äì21:30
    ],
    5: [ // Sexta
        { start: '15:00', minutes: 180 }, // 15:00‚Äì18:00
        { start: '18:30', minutes: 180 }, // 18:30‚Äì21:30
    ],
    6: [], // S√°bado ‚Äî sem sess√µes
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  HELPER FUNCTIONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function addDays(date, days) {
    const d = new Date(date);
    d.setDate(d.getDate() + days);
    return d;
}

function formatDate(d) {
    const year = d.getFullYear();
    const month = String(d.getMonth() + 1).padStart(2, '0');
    const day = String(d.getDate()).padStart(2, '0');
    return `${year}-${month}-${day}`;
}

function getDow(d) {
    return d.getDay();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SCHEDULE GENERATOR
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function generateEnzoSchedule() {
    const tasks = [];
    const startDate = new Date(2026, 1, 16); // Feb 16, 2026 (Monday)
    const endDate = new Date(2026, 8, 30);   // Sep 30, 2026

    // Queue of topics, sorted by phase then by subject priority
    const subjectPriority = {
        'F√≠sica': 1,        // highest
        'Matem√°tica': 2,
        'Qu√≠mica': 3,
        'Biologia': 4,
        'Hist√≥ria': 5,
        'Geografia': 6,
        'Filosofia/Sociologia': 7,
    };

    const queue = [...CURRICULUM].sort((a, b) => {
        if (a.phase !== b.phase) return a.phase - b.phase;
        return (subjectPriority[a.subject] || 99) - (subjectPriority[b.subject] || 99);
    });

    let topicIdx = 0;
    let topicRemaining = queue.length > 0 ? queue[0].minutes : 0;
    let redacaoWeekCounter = 0;

    // Track completed topics for spaced reviews
    const reviews = []; // { date, subject, title, type }

    let currentDate = new Date(startDate);

    while (currentDate <= endDate) {
        const dow = getDow(currentDate);
        const dateStr = formatDate(currentDate);
        const slots = AVAILABILITY[dow] || [];

        if (slots.length === 0) {
            currentDate = addDays(currentDate, 1);
            continue;
        }

        // Sunday: Reda√ß√£o every 2 weeks
        if (dow === 0) {
            redacaoWeekCounter++;
        }

        let dayTasks = [];

        // 1. Add scheduled reviews for this day
        const todayReviews = reviews.filter(r => r.date === dateStr);
        for (const rev of todayReviews) {
            dayTasks.push({
                date: dateStr,
                subject: rev.subject,
                title: rev.title,
                type: 'review',
            });
        }
        // Remove consumed reviews
        const reviewMinutes = todayReviews.length * 20;

        // 2. If Sunday and reda√ß√£o week, add reda√ß√£o in first slot
        let redacaoMinutes = 0;
        if (dow === 0 && redacaoWeekCounter % 2 === 0) {
            dayTasks.push({
                date: dateStr,
                subject: 'Reda√ß√£o',
                title: 'Produ√ß√£o Textual ENEM ‚Äî Tema In√©dito',
                type: 'simulation',
            });
            redacaoMinutes = 90;
        }

        // 3. Calculate remaining budget for this day
        const totalDayMinutes = slots.reduce((sum, s) => sum + s.minutes, 0);
        let budgetMinutes = totalDayMinutes - reviewMinutes - redacaoMinutes;

        // 4. Fill remaining budget with new topics
        let subjectsToday = new Set(dayTasks.map(t => t.subject));
        let lastSubject = null;

        while (budgetMinutes >= 30 && topicIdx < queue.length) {
            const topic = queue[topicIdx];

            // Prefer subject diversity (max 3 per day, avoid consecutive same subject)
            if (topic.subject === lastSubject && subjectsToday.size < 3) {
                // Try to find a different subject
                let found = false;
                for (let j = topicIdx + 1; j < Math.min(topicIdx + 5, queue.length); j++) {
                    if (queue[j].subject !== lastSubject && queue[j].phase <= topic.phase + 1) {
                        // Swap
                        [queue[topicIdx], queue[j]] = [queue[j], queue[topicIdx]];
                        found = true;
                        break;
                    }
                }
                if (!found) {
                    // OK, same subject is fine
                }
            }

            const currentTopic = queue[topicIdx];
            const blockMinutes = Math.min(topicRemaining, budgetMinutes, 90); // Max 90 min per block

            if (blockMinutes < 30) break;

            // Add theory/exercise block
            dayTasks.push({
                date: dateStr,
                subject: currentTopic.subject,
                title: currentTopic.title,
                type: currentTopic.type,
            });

            budgetMinutes -= blockMinutes;
            topicRemaining -= blockMinutes;
            lastSubject = currentTopic.subject;
            subjectsToday.add(currentTopic.subject);

            // Topic finished?
            if (topicRemaining <= 0) {
                // Add fixation block if budget allows
                if (budgetMinutes >= 45 && currentTopic.type === 'class') {
                    dayTasks.push({
                        date: dateStr,
                        subject: currentTopic.subject,
                        title: `Fixa√ß√£o: ${currentTopic.title}`,
                        type: 'exercise',
                    });
                    budgetMinutes -= 45;
                }

                // Schedule spaced reviews
                const reviewDays = [1, 7, 30];
                for (const offset of reviewDays) {
                    const revDate = formatDate(addDays(currentDate, offset));
                    const label = `Revis√£o D+${offset}`;
                    reviews.push({
                        date: revDate,
                        subject: currentTopic.subject,
                        title: `${label}: ${currentTopic.title}`,
                    });
                }

                // Move to next topic
                topicIdx++;
                if (topicIdx < queue.length) {
                    topicRemaining = queue[topicIdx].minutes;
                }
            }
        }

        // If any remaining reviews overflow into available time
        // (already handled above)

        // Add all day tasks to main list
        tasks.push(...dayTasks);

        currentDate = addDays(currentDate, 1);
    }

    // Add any remaining reviews that didn't get their own theory day
    for (const rev of reviews) {
        const revDateObj = new Date(rev.date);
        if (revDateObj > endDate) continue;
        // Check if already added
        const alreadyExists = tasks.some(t => t.date === rev.date && t.title === rev.title);
        if (!alreadyExists) {
            tasks.push({
                date: rev.date,
                subject: rev.subject,
                title: rev.title,
                type: 'review',
            });
        }
    }

    return tasks;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  MAIN EXECUTION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

async function main() {
    console.log('üîç Buscando user_id do Enzo...');

    // Find Enzo's user_id by querying profiles or auth
    const { data: profiles, error: profileError } = await supabase
        .from('profiles')
        .select('user_id, full_name')
        .ilike('full_name', '%enzo%');

    let userId = null;

    if (profiles && profiles.length > 0) {
        userId = profiles[0].user_id;
        console.log(`‚úÖ Encontrado: ${profiles[0].full_name} ‚Üí ${userId}`);
    } else {
        // Try to find via auth (won't work with anon key, but let's try the profiles table with email patterns)
        console.log('‚ö†Ô∏è N√£o encontrado por nome. Tentando buscar por email...');

        // Check if there's an email field in profiles
        const { data: allProfiles } = await supabase.from('profiles').select('*');
        console.log('Todos os perfis:', JSON.stringify(allProfiles, null, 2));

        if (!allProfiles || allProfiles.length === 0) {
            console.error('‚ùå Nenhum perfil encontrado. O aluno precisa se cadastrar primeiro.');
            console.log('\nüìã Instru√ß√£o: O Enzo precisa criar uma conta em enzomartins0508@gmail.com na plataforma.');
            console.log('  Depois, rode este script novamente.');
            process.exit(1);
        }

        // Show available profiles for manual selection
        console.log('\nPerfis dispon√≠veis:');
        allProfiles.forEach((p, i) => {
            console.log(`  ${i + 1}. ${p.full_name || 'Sem nome'} (user_id: ${p.user_id})`);
        });
        process.exit(1);
    }

    // Generate schedule
    console.log('\nüìÖ Gerando cronograma individualizado...');
    const tasks = generateEnzoSchedule();
    console.log(`üìä ${tasks.length} tarefas geradas (Fev 16 ‚Äì Set 30, 2026)`);

    // Stats
    const subjects = {};
    for (const t of tasks) {
        subjects[t.subject] = (subjects[t.subject] || 0) + 1;
    }
    console.log('\nüìà Distribui√ß√£o por mat√©ria:');
    for (const [s, count] of Object.entries(subjects).sort((a, b) => b[1] - a[1])) {
        console.log(`  ${s}: ${count} blocos`);
    }

    const types = {};
    for (const t of tasks) {
        types[t.type] = (types[t.type] || 0) + 1;
    }
    console.log('\nüìã Por tipo:');
    for (const [ty, count] of Object.entries(types)) {
        console.log(`  ${ty}: ${count}`);
    }

    // Confirm before inserting
    console.log(`\nüéØ Pronto para inserir ${tasks.length} tarefas para user_id: ${userId}`);
    console.log('   Pressione Ctrl+C para cancelar, ou aguarde 3 segundos...');

    await new Promise(r => setTimeout(r, 3000));

    // Delete existing IA-generated tasks for this user (future only)
    const today = formatDate(new Date());
    console.log('\nüóëÔ∏è Removendo cronograma IA anterior...');
    const { error: deleteError } = await supabase
        .from('schedule_tasks')
        .delete()
        .eq('user_id', userId)
        .eq('is_ia_generated', true)
        .gte('date', today);

    if (deleteError) {
        console.error('Erro ao deletar:', deleteError);
    }

    // Insert in batches
    console.log('üìù Inserindo tarefas...');
    const rows = tasks.map(t => ({
        user_id: userId,
        date: t.date,
        subject: t.subject,
        title: t.title,
        type: t.type,
        completed: false,
        is_ia_generated: true,
    }));

    const BATCH_SIZE = 200;
    let inserted = 0;
    for (let i = 0; i < rows.length; i += BATCH_SIZE) {
        const chunk = rows.slice(i, i + BATCH_SIZE);
        const { error } = await supabase.from('schedule_tasks').insert(chunk);
        if (error) {
            console.error(`‚ùå Erro no batch ${i / BATCH_SIZE + 1}:`, error);
            break;
        }
        inserted += chunk.length;
        console.log(`  ‚úÖ ${inserted}/${rows.length} inseridas`);
    }

    console.log(`\nüéâ Cronograma do Enzo inserido com sucesso! (${inserted} tarefas)`);
    console.log('   Ele pode acessar o app e ver√° o cronograma completo.');
}

main().catch(console.error);
